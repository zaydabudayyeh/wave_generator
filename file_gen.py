import matplotlib.pyplot as plt
import numpy as np

def file_gen(data, name, N, sample_depth):	
	plt.figure()
	plt.plot(data)
	plt.axhline(y =2**(8*sample_depth-1))
	plt.axhline(y =-1*2**(8*sample_depth-1))
	plt.savefig(f"output_files/{name}.png")
	with open(f'output_files/{name}.txt', 'w') as file:
		for i in data:
			if (i < 0):	
				file.write(hex(i % (1<<(8*sample_depth))).replace('0x', ''))
			else:
				file.write(hex(i).replace('0x', ''))
			file.write("\n")

	with open(f'output_files/{name}.sv', 'w') as file:
		file.write(f"/* File generated by helper script from https://github.com/zaydabudayyeh/wave_generator\n")
		file.write(f"for use with ECE385 course at the University of Illinois at Urbana Champaign */\n\n")
		file.write(f"module {name}_rom(\ninput clk,\ninput [{int(np.ceil(np.log2(N)))-1}:0] addr,\n")
		file.write(f"output logic [{8*sample_depth-1}:0] q\n);\n\n")
		file.write(f"logic [{8*sample_depth-1}:0] rom [{N}];\n")
		file.write("always_ff @(posedge clk) begin\n")
		file.write("	q <= rom[addr];\n")
		file.write("end\n")
		file.write(f"initial begin $readmemh(\"{name}.txt\", rom); end\n")
		file.write("endmodule")
